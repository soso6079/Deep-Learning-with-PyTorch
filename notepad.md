검증셋으로 모델을 훈련시키지는 않았지만 검증셋에서의 모델 성능을 보고 제일 좋은 훈련 에포크를 선택한 방식에 문제가 있다. 일종의 데이터 누출에 해당하기 때문이다. 즉 이는 새로운 데이터에 대해서는 모델이 동일한 성능을 보여주지 못할 가능성이 높다는 이야기이다.

이러한 문제를 방지하기 위해 데이터셋을 **훈련셋, 검증셋, 테스트셋** 세 가지로 나누기도 한다. 


## 다음 단계는?

### 과적합 방지: 더 나은 정규화

지금까지 만든 모델들 대부분에서 과적합이 발생했다. 이를 위해 데이터를 밸런싱하고 증강시키곤 했다. 또 검증셋에 대해 과적합이 시작되면 훈련을 중단시켜서 빠져나왔다. 먼저 과적합을 시키고 과적합을 줄이는 식의 패턴은 일반적인 절차다.


#### 전통적인 정규화와 증강 방법

- 드랍아웃
- 증강: Digital crumple, Elastic deformation

#### 더 추상적인 증강 방법

- **레이블 스무딩**(**label smoothing**): 원핫 분포 대신 '잘못된' 클래스에 작은 확률 질량을 배치
- **믹스업**(**mixup**): 손실값에 대한 선형성을 가정하고 랜덤하게 입력과 레이블을 동시에 채움. 예측 안정성을 높일 수 있다.

#### 앙상블링

- **앙상블링**(**ensembling**): 여러개의 모델을 훈련하고 평가한 뒤, 예측할 때는 모든 모델을 실행해서 예측을 평균하는 방식. 평균을 사용하는 방식은 **확률적 가중치 평균**(**Stochastic weight averaging**)의 핵심이다.

#### 신경망이 학습할 내용 일반화하기

- **멀티태스크 학습**(**Multitask learning**): 평가에 사용하는 출력 외에 다른 출력에 대해서도 모델이 학습하도록 만드는 방식. 예를 들어 결절과 비결절을 훈련시킬 때 동시에 양성과 악성도 구분한다.
- **준지도 학습**(**semi-supervised learning**): 비지도 데이터 증강(unsupervised data augmentation)에 최근 제안된 방식이다. 예측이 맞을지 모르지만 데이터 증강 여부와 상관없이 모델이 일관되게 예측하도록 만든다.

  1. 평소처럼 데이터로 모델을 훈련시킨다.
  2. 레이블 되지 않은 데이터에 대해 증강되지 않은 샘플을 대상으로 예측한다.
  3. 증강된 샘플을 대상으로 증강되지 않은 샘플과 동일한 예측이 가능하게끔 모델을 훈련한다.
- **프리텍스트 작업**(**pretext task)**:**자기 지도 학습**(**self-supervised learning**)의 일종으로 task를 만들어 성능을 향상시킨다. 대표적인 방식으로 일부러 입력을 손상시키는 방법이 잇다. 그 후 모델의 많은 부분을 공유하면서 원래 모양을 재구성하도록 훈련시키거나 분류기가 손상된 데이터와 실제 데이터를 구분할 수 있도록 훈련시킨다.
- **대조 학습**(**contrastive learninh**)
- **모멘텀 대조**(**Momentum contrast**)

### 훈련 데이터 개선

악성 분류 문제에서 여러 방사선 전문의가 세밀하게 분류한 데이터셋이라고 설명했었다. 악성인가 아닌가, 라는 이분법으로 나누면서 버려버린 데이터를 활용하는 방법은 어떤 것이 있을까? 가장 쉬운 방법은 다섯 개의 클래스를 그대로 이용하는 것이다. 이를 원 핫 인코딩하고 주어진 결절에 대한 레이블에 대해 평균을 내는 것이다. 예를 들어 4명의 방사선 전문의가 결절을 본 후 2명은 '불확실', 한명은 '다소 의심', 나머지 한명이 '악성 의심'이라고 분류했다면 모델의 출력과 벡터 (0, 0, 0.5, 0.25, 0.25)로 타겟의 확률 분포와의 크로스 엔트로피로 훈련할 수 있다.


세그멘테이션 측면에서는 우리가 만든 모델과 PyLIDC에서 제공하는 마스크를 서로 비교해볼 수 있다. LIDC는 여러 방사선 전문의가 애노테이션을 달았고 '높은 일치도' 그룹과 '낮은 일치도' 그룹으로 나눌 수 있다. 이를 분류기가 쉽게 분류해내면 '쉬움'에 넣고 그렇지 않으면 '어려움' 그룹에 넣어서 앞선 두 그룹과 비교하는 것도 흥미로울 것이다.


결절을 악성 유형별로도 나눠볼 수 있다. 전문가가 훈련 데이터를 살펴보고 암 유형에 따라 결절을 분류한 뒤, 모델에 해당 유형을 알려준다면 더 효과적인 훈련이 이루어질 수 있다.
